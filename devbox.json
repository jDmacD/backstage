{
  "$schema": "https://raw.githubusercontent.com/jetify-com/devbox/0.15.1/.schema/devbox.schema.json",
  "packages": [
    "nodejs_24@latest",
    "yarn@latest",
    "python@latest"
  ],
  "shell": {
    "init_hook": [
      "export BWS_SECRET=$(bws secret get 9644eb16-81bf-4b8e-8661-b3730174afba | jq -rc '.value | fromjson')",
      "export KUBERNETES_TOKEN=$(kubectl create token backstage-viewer -n default --duration=8760h)",
      "export ARGOCD_USERNAME=$(echo $BWS_SECRET | jq -r .ARGOCD_USERNAME)",
      "export ARGOCD_PASSWORD=$(echo $BWS_SECRET | jq -r .ARGOCD_PASSWORD)",
      "export GITHUB_TOKEN=$(echo $BWS_SECRET | jq -r .GITHUB_TOKEN)",
      "export AUTH_GITHUB_CLIENT_SECRET=$(echo $BWS_SECRET | jq -r .AUTH_GITHUB_CLIENT_SECRET)",
      "export AUTH_GITHUB_CLIENT_ID=$(echo $BWS_SECRET | jq -r .AUTH_GITHUB_CLIENT_ID)",
      "export AZURE_CLIENT_ID=$(echo $BWS_SECRET | jq -r .AZURE_CLIENT_ID)",
      "export AZURE_CLIENT_SECRET=$(echo $BWS_SECRET | jq -r .AZURE_CLIENT_SECRET)",
      "export AZURE_TENANT_ID=$(echo $BWS_SECRET | jq -r .AZURE_TENANT_ID)",
      "export NODE_OPTIONS=--no-node-snapshot"
    ],
    "scripts": {
      "start": [
        "yarn start"
      ],
      "create-token": [
        "kubectl apply -f kubernetes/backstage-sa.yaml",
        "kubectl create token backstage-viewer -n default --duration=8760h"
      ],
      "build": [
        "docker buildx build --platform linux/amd64,linux/arm64 --tag jdmacd/backstage:0.0.1 --push -f Dockerfile ."
      ],
      "build-slim": [
        "docker buildx build --platform linux/amd64,linux/arm64 --tag jdmacd/backstage-slim:0.0.1 --push -f slim.Dockerfile ."
      ]
    }
  },
  "env_from": "jetpack-cloud"
}
